= Deploying the application via GitOps
include::_attributes.adoc[]

== GitOps 経由でアプリケーションをデプロイする

OpenShift GitOps/{argocd} を使用して、namespace にアプリケーションをデプロイします。

- 右上のメニューのリンクをクリックして、{argocd} コンソールにアクセスします。
+
[.bordershadow]
image::05/05-open-argocd.png[]

- "Log in via OpenShift" をクリックして、これまでのラボで利用している資格情報を使用してログインします。
+
* アカウント ID: `{user}`
* パスワード: `{password}`

__Note: 下の画像はuser1になっていますが、割り当てられたユーザーを使用してください。__

[.bordershadow]
image::05/05-login-argocd-openshift.png[]
+
[.bordershadow]
image::05/05-openshift-login.png[]

- ログインすると、 {argocd} コンソールにリダイレクトされます。 "Applications" タブ "Create Application" をクリックします。
+
[.bordershadow]
image::05/05-create-application.png[]

- 開いたパネルの右上隅にある "Edit as YAML" をクリックします。
+
[.bordershadow]
image::05/05-edit-as-yaml.png[]

- 次のテキストの内容をコピーし、エディターに貼り付けて (デフォルトの内容を置き換えて)、 "Save" をクリックします。
+
[source, yaml, subs="attributes+"]
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: claim-insurance-app-{user}
spec:
  destination:
    server: https://kubernetes.default.svc
    namespace: {user}
  project: project-{user}
  source:
    path: lab-materials/05/app
    repoURL: https://github.com/rh-aiservices-bu/parasol-insurance.git
    targetRevision: main-rhoai-2.13
  syncPolicy:
    automated:
      prune: true
      selfHeal: false
    syncOptions: [CreateNamespace=false]
+
[.bordershadow]
image::05/05-application-yaml-save.png[]

- フォームビューに戻り、 "Create" をクリックします。
+
[.bordershadow]
image::05/05-create-application-validation.png[]

- アプリケーションのデプロイが開始されます。カードをクリックすると詳細が表示されます。
+
[.bordershadow]
image::05/05-application-creation.png[]

- 数秒後、すべての要素がデプロイされ、アプリケーションは "Healthy" および "Synced" と表示されます。
+
[.bordershadow]
image::05/05-application-deployed.png[] 

- これで、次の URL でアプリケーションにアクセスできるようになります。
https://ic-app-{user}.{openshift_cluster_ingress_domain}/[https://ic-app-{user}.{openshift_cluster_ingress_domain}/,window=_blank]

ブラウザで URL を開いてアプリケーションにアクセスし、次のステップに進みます。
