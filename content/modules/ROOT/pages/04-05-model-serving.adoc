= Model Serving
include::_attributes.adoc[]

. この時点で、モデルを {rhoai-short} モデル サービングにデプロイする必要があります。
. もう 1 つのデータ接続を作成します...
.. ほぼ同じ情報を使用します。
.. ただし、バケット名を `{user}` から `models` に変更します。


== Create a Data Connection

== データ接続の作成

* データ サイエンス プロジェクトの *Data connections* タブで、 **Add data connection** をクリックして、モデルのコピーが保存されている共有ストレージ (Minio) を参照する接続を作成します。
+
[.bordershadow]
image::04/04-add-data-connection.png[]

* 入力する必要がある情報は次のとおりです。
** Name:
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
Shared Minio - model
** Access Key:
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
{minio-user}
** Secret Key:
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
{minio-pass}
** Endpoint:
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
{minio-endpoint}
** Region:
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
none
** Bucket:
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
models

* 結果は次のようになります:
+
[.bordershadow]
image::04/model-data-connection.png[モデル接続]

== モデル サーバーを作成する

プロジェクトで **Models** タブを選択してモデル サーバーを作成します。

**非常に重要** : 次の手順では、注意して適切なタイプのモデル サーバーを選択してください。そうしないと、プロジェクトをリセットする必要があります。

* **Multi-model serving platform** タイプのモデル (右側) で、 **Add model server** をクリックします。
+
[.bordershadow]
image::04/add-model-server.png[]

* 入力する必要がある情報は次のとおりです:

** Model server name:
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
My first Model Server
** Serving runtime:
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
OpenVINO Model Server
** Number of model server replicas to deploy:
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
1
** Model server size
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
Standard
** Accelerator
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
None (bug: even when selecting `None`, the drop down will still show `Select...`)
** Model route
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
unchecked
** Token authorization
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
unchecked


* 結果は次のようになります:
+
[.bordershadow]
image::04/add-model-server-config.png[]

* **Add** をクリックすると、モデル サーバーを作成できます。

== モデルのデプロイ

プロジェクトの *Models* タブで、  **Models and model servers** で次のようにします。

* **Deploy model** をクリックします
+
[.bordershadow]
image::04/select-deploy-model.png[]

* 入力する必要がある情報は次のとおりです:

** Model name:
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
My first Model
** Model server
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
My first Model Server (pre-filled)
** Model server - Model framework
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
onnx-1
** Existing data connection - Name
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
Shared Minio - model
** Existing data connection - Path
[.lines_space]
[.console-input]
[source, text]
[subs=attributes+]
accident/

* 結果は次のようになります:
+
[.bordershadow]
image::04/deploy-a-model.png[]

* [**Deploy**] をクリックします。
* モデルが正常にデプロイされると、2 ～ 3 分後にステータスが緑色で表示されます。
+
[.bordershadow]
image::04/model-deployed-success.png[]

クエリを実行して、モデルが実際に動作していることを確認します。

== 提供されたモデルのクエリ

モデルが提供されたら、クエリ可能なエンドポイントとして使用できます。モデルにリクエストを送信して結果を取得します。以前のノートブックベースのバージョンとは異なり、これはクラスター内で作業しているすべての人に適用されます。同僚でもアプリケーションでもかまいません。

* まず、モデル サーバーの URL を取得する必要があります。
* これを行うには、 *Interface endpoint* 列の *Internal Service* リンクをクリックします。
* ポップアップに、モデル サーバーの URL がいくつか表示されます。
+
[.bordershadow]
image::04/inference-url.png[]

* **RestUrl** をメモするかコピーします。これは `\http://modelmesh-serving.{user}:8008` のようになります。

この URL を使用してモデルをクエリします。

- 実行中のワークベンチで、 `parasol-insurance/lab-materials/04` フォルダーに移動します。
- `04-05-model-serving.ipynb` というノートブックを探して開きます。
- ノートブックのセルを実行して、何が起こっているかを確認します。
